# esp32SmartClockV3

‚è∞ ESP32 Smart Clock v3
–£–º–Ω—ã–µ —á–∞—Å—ã –Ω–∞ ESP32 —Å TFT-–¥–∏—Å–ø–ª–µ–µ–º, –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏, RTC, NTP, –ø–æ–≥–æ–¥–æ–π –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º UI.
–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞:
—Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É 24/7
–º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É —ç–∫—Ä–∞–Ω–∞
—á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —ç–∫—Ä–∞–Ω–æ–≤
—É–¥–æ–±–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é 4 –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
üïí –í—Ä–µ–º—è
RTC (DS1302) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
NTP ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
–†–∞–±–æ—Ç–∞ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è NTP (RTC —Å—Ä–∞–∑—É –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç system time)
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
DST: AUTO / OFF
AUTO ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –ª–µ—Ç–æ/–∑–∏–º–∞ (EU / –£–∫—Ä–∞–∏–Ω–∞)
OFF ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ DST

üåô Night Mode
AUTO / ON / OFF
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏
–ü–ª–∞–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–º–∞–º–∏
–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–π–º–µ—Ä—ã –∏ delay

üå¶ –ü–æ–≥–æ–¥–∞
OpenWeather API
–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç—å
–û—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–æ–≥–Ω–æ–∑–∞

üñ• UI
TFT –¥–∏—Å–ø–ª–µ–π (Adafruit ST7735)
StatusBar:
Wi-Fi
NTP / RTC
–î–∞—Ç–∞
–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä DST+
BottomBar —Å –∫–Ω–æ–ø–∫–∞–º–∏
–ü–æ–ª–Ω–æ—Å—Ç—å—é reactive UI:
–ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
–Ω–∏–∫–∞–∫–∏—Ö –º–∏–≥–∞–Ω–∏–π
üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
4 –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
–ö–æ—Ä–æ—Ç–∫–∏–µ –∏ –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è
–ï–¥–∏–Ω—ã–π UX-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤

üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
–ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ —Å–ª–æ–∏:
src/
‚îú‚îÄ core/          // ScreenManager, AppController
‚îú‚îÄ services/      // –ª–æ–≥–∏–∫–∞ (Time, Night, Forecast, Preferences, DST)
‚îú‚îÄ screens/       // —ç–∫—Ä–∞–Ω—ã (Clock, Forecast, Settings)
‚îú‚îÄ ui/            // StatusBar, ButtonBar, Separator
‚îú‚îÄ theme/         // —Ç–µ–º—ã –∏ —Ü–≤–µ—Ç–∞
‚îî‚îÄ main.cpp

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
‚ùå –Ω–∏–∫–∞–∫–∏—Ö delay()
‚ùå –Ω–∏–∫–∞–∫–∏—Ö millis() –≤ UI
‚úÖ dirty-flags + –≤–µ—Ä—Å–∏–∏ (UiVersionService)
‚úÖ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ (TimeService)
‚úÖ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ UI
üß© –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

TimeService
–£–ø—Ä–∞–≤–ª—è–µ—Ç system time ESP32
RTC ‚Üí –ø–µ—Ä–≤–∏—á–Ω—ã–π
NTP ‚Üí –≤—Ç–æ—Ä–∏—á–Ω—ã–π
DST –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
–≠–∫—Å–ø–æ—Ä—Ç tm –¥–ª—è RTC

DstService
Stateless —Å–µ—Ä–≤–∏—Å

–ü—Ä–∞–≤–∏–ª–∞ –ï–°:
–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –º–∞—Ä—Ç–∞ / –æ–∫—Ç—è–±—Ä—è
–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RTC –∏–ª–∏ NTP –Ω–∞–ø—Ä—è–º—É—é
PreferencesService

EEPROM AT24C256
CRC-–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–•—Ä–∞–Ω–∏—Ç:
Night Mode
Timezone
DST offset
—è—Ä–∫–æ—Å—Ç—å
–ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–∫—Ä–∞–Ω

‚öôÔ∏è –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —á–∞—Å—Ç—å
–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
WeMos ESP32 D1/R32
–î–∏—Å–ø–ª–µ–π
TFT ST7735 (SPI) 

RTC
DS1302
CLK ‚Üí GPIO14
DAT ‚Üí GPIO27
RST ‚Üí GPIO19

EEPROM
AT24C256 (I2C)
SDA ‚Üí GPIO21
SCL ‚Üí GPIO22

–î–∞—Ç—á–∏–∫–∏
DHT11 ‚Üí GPIO13

–ö–Ω–æ–ø–∫–∏
LEFT ‚Üí GPIO16
RIGHT ‚Üí GPIO17
OK ‚Üí GPIO25
BACK ‚Üí GPIO26

üß™ –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PlatformIO.

platformio run
platformio run --target upload

üå± Git workflow (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
main        // —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
dev         // —Ç–µ–∫—É—â–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
feature/*   // –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏


–ü—Ä–∏–º–µ—Ä:

git checkout dev
git checkout -b feature/dst

üìå –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

‚úî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞

‚úî DST AUTO / OFF —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

‚úî Night Mode –∑–∞–≤–µ—Ä—à—ë–Ω

‚úî UI –±–µ–∑ –º–∏–≥–∞–Ω–∏–π

üîß –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞ UX
